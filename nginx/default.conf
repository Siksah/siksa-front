# =========================================================
# 1. HTTP (80 í¬íŠ¸) ë¸”ë¡: React ì•±ì„ HTTPë¡œ ì§ì ‘ ì„œë¹„ìŠ¤ (ì„ì‹œ ì„¤ì •)
# =========================================================
server {
    # 80 í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  HTTP ìš”ì²­ì„ ìˆ˜ì‹ 
    listen 80;
    
    # âœ… ìˆ˜ì •ë¨: ë„ë©”ì¸ì´ ì—†ìœ¼ë¯€ë¡œ ì™€ì¼ë“œì¹´ë“œ(_)ë¥¼ ì‚¬ìš©í•˜ì—¬ IP ì£¼ì†Œ ì ‘ì† ë° ëª¨ë“  í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ í—ˆìš©í•©ë‹ˆë‹¤.
    server_name _;

    # Nginxê°€ Reactì˜ ë¹Œë“œëœ ì •ì  íŒŒì¼(index.html, .js, .css ë“±)ì„ ì°¾ì„ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
    index index.html;
    root /usr/share/nginx/html;

    # ----------------------------------------------------
    # ğŸ‘‡ í”„ë¡ íŠ¸ì—”ë“œ (React SPA) ì„œë¹™
    # ----------------------------------------------------
    location / {
        # ë¦¬ë””ë ‰ì…˜ ì œê±°, 80 í¬íŠ¸ì—ì„œ ì§ì ‘ íŒŒì¼ ì„œë¹™
        try_files $uri $uri/ /index.html; 
    }
    
    # ----------------------------------------------------
    # ğŸ‘‡ API ìš”ì²­ ë°±ì—”ë“œ (NestJS) í”„ë¡ì‹œ
    # ----------------------------------------------------
    location /api {
        # proxy_pass: Docker ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ì˜ NestJS ì»¨í…Œì´ë„ˆë¡œ ìš”ì²­ì„ ì „ë‹¬
        proxy_pass http://backend-app:3001;
        
        # ë°±ì—”ë“œ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì‹¤ì œ IPì™€ í˜¸ìŠ¤íŠ¸ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ í—¤ë”ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # ğŸ’¡ ì¤‘ìš”: í˜„ì¬ HTTPë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ HTTPë¡œ ì„¤ì •í•©ë‹ˆë‹¤. (HTTPS ê°•ì œ í•´ì œ)
        proxy_set_header X-Forwarded-Proto http;
    }
}

# =========================================================
# 2. HTTPS (443 í¬íŠ¸) ë¸”ë¡: ë„ë©”ì¸ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ ì „ì²´ ì£¼ì„ ì²˜ë¦¬ (ë¹„í™œì„±í™”)
# Nginxê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¸ì¦ì„œë¥¼ ë¡œë“œí•˜ë ¤ë‹¤ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
# =========================================================
# server {

#     listen 443 ssl;
#     listen [::]:443 ssl http2;
    
#     server_name siksa-app.com www.siksa-app.com;

#     ssl_certificate /etc/letsencrypt/live/siksa-app.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/siksa-app.com/privkey.pem;

#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_prefer_server_ciphers on;

#     index index.html;
#     root /usr/share/nginx/html;

#     location / {
#         try_files $uri $uri/ /index.html; 
#     }
    
#     location /api {
#         proxy_pass http://backend-app:3001;
        
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
#         proxy_set_header X-Forwarded-Proto https;
#     }
# }