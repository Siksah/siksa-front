# =========================================================
# 1. HTTP (80 í¬íŠ¸) ë¸”ë¡: React ì•±ì„ HTTPë¡œ ì§ì ‘ ì„œë¹„ìŠ¤ (ì„ì‹œ ì„¤ì •)
# =========================================================
server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html index.htm; # index íŒŒì¼ ëª…ì‹œ

    # ----------------------------------------------------
    # ğŸ‘‡ ì •ì  íŒŒì¼ (Static Assets) ì²˜ë¦¬: ìºì‹± ë° ë¦¬ë‹¤ì´ë ‰ì…˜ ë£¨í”„ ë°©ì§€
    # ----------------------------------------------------
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2|woff|ttf|svg|eot)$ {
        expires 1y; 
        # ì •ì  íŒŒì¼ì´ ì—†ìœ¼ë©´ 404ë¥¼ ë°˜í™˜í•˜ê³ , SPA í´ë°±ì„ ê±°ì¹˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
        try_files $uri =404; 
    }

    # ----------------------------------------------------
    # ğŸ‘‡ í”„ë¡ íŠ¸ì—”ë“œ (React SPA) ì„œë¹™ ë° í´ë°± ë¡œì§ (í•µì‹¬ ìˆ˜ì •)
    # ----------------------------------------------------
    location / {
        # 1. ìš”ì²­ëœ URI($uri)ë¥¼ ì°¾ëŠ”ë‹¤. (ì˜ˆ: /main.js)
        # 2. ìš”ì²­ëœ URI ë’¤ì— /ë¥¼ ë¶™ì¸ ë””ë ‰í† ë¦¬ë¥¼ ì°¾ëŠ”ë‹¤. (ì˜ˆ: /assets/)
        # 3. ìœ„ ë‘ ê°€ì§€ ëª¨ë‘ ì‹¤íŒ¨í•˜ë©´, /index.htmlì„ ë°˜í™˜í•˜ì—¬ SPA í´ë°±ì„ ìˆ˜í–‰í•œë‹¤.
        #    (ì´ ë•Œ NginxëŠ” ì‘ë‹µ ì½”ë“œë¥¼ 200ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.)
        try_files $uri $uri/ /index.html;
    }
    
    # ----------------------------------------------------
    # ğŸ‘‡ API ìš”ì²­ ë°±ì—”ë“œ (NestJS) í”„ë¡ì‹œ
    # ----------------------------------------------------
    location /api {
        proxy_pass http://backend-app:3001;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto http;
    }
}

# =========================================================
# 2. HTTPS (443 í¬íŠ¸) ë¸”ë¡: ë„ë©”ì¸ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ ì „ì²´ ì£¼ì„ ì²˜ë¦¬ (ë¹„í™œì„±í™”)
# Nginxê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¸ì¦ì„œë¥¼ ë¡œë“œí•˜ë ¤ë‹¤ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
# =========================================================
# server {

#     listen 443 ssl;
#     listen [::]:443 ssl http2;
    
#     server_name siksa-app.com www.siksa-app.com;

#     ssl_certificate /etc/letsencrypt/live/siksa-app.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/siksa-app.com/privkey.pem;

#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_prefer_server_ciphers on;

#     index index.html;
#     root /usr/share/nginx/html;

#     location / {
#         try_files $uri $uri/ /index.html; 
#     }
    
#     location /api {
#         proxy_pass http://backend-app:3001;
        
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
#         proxy_set_header X-Forwarded-Proto https;
#     }
# }