server {
    listen 80;

    # 기본 index 파일 설정: 요청이 폴더로 들어왔을 때 기본으로 제공할 파일
    index index.html;

    # Nginx가 React의 빌드된 정적 파일(index.html, .js, .css 등)을 찾을 루트 디렉토리
    # 이 경로는 frontend.Dockerfile에서 파일을 복사한 위치입니다.
    root /usr/share/nginx/html;

    # 모든 요청을 처리합니다.
    location / {
        # try_files $uri $uri/ /index.html;
        # 이 설정이 SPA(Single Page Application)에서 매우 중요합니다.
        # Nginx가 요청된 URI($uri)를 찾지 못할 경우 (예: /about 경로), 
        # 404 오류 대신 React 앱의 기본 파일인 /index.html을 반환하여 
        # React Router가 경로 처리를 담당하게 합니다.
        try_files $uri $uri/ /index.html; 
    }
    
    # API 요청을 백엔드 컨테이너로 프록시합니다.
    # 브라우저에서 '/api/users'와 같은 요청이 오면,
    # Nginx가 이 요청을 Docker 네트워크 내부의 NestJS 컨테이너로 전달합니다.
    location /api {
        # proxy_pass: 요청을 전달할 목적지
        # http://nestjs-app:3001 에서 'nestjs-app'은 docker-compose.yml에 정의된 서비스 이름입니다.
        # 3001은 NestJS 컨테이너의 내부 포트입니다.
        proxy_pass http://backend-app:3001;
        
        # 백엔드 서버가 클라이언트의 실제 IP와 호스트 정보를 알 수 있도록 헤더를 설정합니다.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}